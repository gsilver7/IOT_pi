{"version":3,"file":"builder.js","sourceRoot":"","sources":["../../../../src/record/builder.ts"],"names":[],"mappings":";;;AAEA,mDAAoD;AAI7C,MAAM,eAAe,GAC1B,CAAC,IAAiB,EAAE,EAAE,CAAC,CAAC,UAAuB,EAAE,EAAE;IACjD,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;IAE7B,OAAO,UAAU,CAAC,OAAO,CAAC,CAAC,SAAS,EAAE,EAAE;QACtC,SAAS,CAAC,UAAU,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;QAC7C,MAAM,QAAQ,GAAG,SAAS,CAAC,UAAU,EAAE,CAAC;QACxC,MAAM,SAAS,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC;QACnC,OAAO,SAAS,CAAC;IACnB,CAAC,CAAC,CAAC;AACL,CAAC,CAAC;AAVS,QAAA,eAAe,mBAUxB;AAEG,MAAM,eAAe,GAC1B,CAAC,IAAiB,EAAE,EAAE,CACtB,CAAC,SAAoB,EAAE,oBAA4B,EAAE,EAAE;IACrD,OAAO,SAAS,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE;QAC3B,MAAM,SAAS,GAAG,IAAI,yBAAa,CACjC;YACE,WAAW,EAAE,GAAG,CAAC,IAAI;YACrB,eAAe,EAAE,IAAI,CAAC,OAAO;YAC7B,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,cAAc,EAAE,oBAAoB;YACpC,UAAU,EAAE,GAAG,CAAC,QAAQ,CAAC,MAAM;SAChC,EACD,GAAG,CAAC,QAAQ,CACb,CAAC;QACF,OAAO,SAAS,CAAC;IACnB,CAAC,CAAC,CAAC;AACL,CAAC,CAAC;AAhBS,QAAA,eAAe,mBAgBxB","sourcesContent":["import type { DtlsContext } from \"../context/dtls\";\nimport type { Handshake } from \"../typings/domain\";\nimport { DtlsPlaintext } from \"./message/plaintext\";\n\nexport type Message = { type: number; fragment: Buffer };\n\nexport const createFragments =\n  (dtls: DtlsContext) => (handshakes: Handshake[]) => {\n    dtls.lastFlight = handshakes;\n\n    return handshakes.flatMap((handshake) => {\n      handshake.messageSeq = dtls.sequenceNumber++;\n      const fragment = handshake.toFragment();\n      const fragments = fragment.chunk();\n      return fragments;\n    });\n  };\n\nexport const createPlaintext =\n  (dtls: DtlsContext) =>\n  (fragments: Message[], recordSequenceNumber: number) => {\n    return fragments.map((msg) => {\n      const plaintext = new DtlsPlaintext(\n        {\n          contentType: msg.type,\n          protocolVersion: dtls.version,\n          epoch: dtls.epoch,\n          sequenceNumber: recordSequenceNumber,\n          contentLen: msg.fragment.length,\n        },\n        msg.fragment,\n      );\n      return plaintext;\n    });\n  };\n"]}